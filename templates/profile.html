{% extends "base.html" %}
{% block content %}
{% import "macros/icons.html" as icons %}
{% include "header.html" %}

<div class="profile-container">

    <h4 class="mb-3">Perfil de Usuario</h4>

    {% if request.query_params.get('success') == 'zoom_linked' %}
    <div class="form-message form-message--success mb-3">
        ¡Cuenta de Zoom vinculada correctamente!
    </div>
    {% endif %}

    {% if request.query_params.get('error') == 'zoom_link_failed' %}
    <div class="form-message form-message--error">
        {{ icons.AlertTriangleIcon(16) }}
        No se pudo vincular la cuenta de Zoom. Inténtalo de nuevo.
    </div>
    {% endif %}

    <div class="cards-grid">
        <div class="card">
            <h5 class="card-title">User Information</h5>
            <div class="profile-info">
                <span class="profile-info-label">ID:</span>
                <span class="profile-info-value">***{{ user.id[-6:] }}</span>
            </div>
            <div class="profile-info">
                <span class="profile-info-label">Name:</span>
                <span class="profile-info-value">{{ user.full_name }}</span>
            </div>
            <div class="profile-info">
                <span class="profile-info-label">Email:</span>
                <span class="profile-info-value">{{ user.email | default("No email provided") }}</span>
            </div>
        </div>

        <div class="profile-card">
            <h5 class="profile-card-title">API connections</h5>
            <div class="zoom-linking-section">
                <div class="zoom-info">
                    <span class="zoom-icon"></span>
                    <span>Zoom API</span>
                </div>
                {% if is_zoom_linked %}
                <div class="link-status link-status--linked">
                    <span>Linked Account</span>
                    <span>***{{ user.zoom_user_id[-6:] }}</span>
                </div>
                {% else %}
                <div class="link-status link-status--unlinked">
                    <span>Not Linked</span>
                </div>
                <button class="btn btn--primary" id="zoom-auth-btn">
                    <span>Link Zoom Account</span>
                </button>
                {% endif %}
            </div>
        </div>

        {% if user.role == 'admin' %}
        <div class="profile-card">
            <h5 class="profile-card-title">Administration</h5>
            <a href="/admin/users" class="btn btn--primary">Gestionar Usuarios</a>
        </div>
        {% endif %}
    </div>
</div>
<script>
    document.getElementById('zoom-auth-btn').addEventListener('click', function () {
        const width = 600;
        const height = 600;
        const left = (window.innerWidth - width) / 2;
        const top = (window.innerHeight - height) / 2;

        window.open(
            '/auth/zoom',
            'zoomAuth',
            `width=${width},height=${height},left=${left},top=${top}`
        );
    });
</script>

{% endblock %}